/*!
 * jQuery Multiple Selector Plugin
 *
 * Copyright 2013 Hideki Abe <hideki.abe@skyward-design.net>
 * Released under the MIT license
 *
 * Version: 0.1.0
 * Date: 2013-09-18
 */
(function(i,t,e){"use strict";function s(t,e){this.element=t,this.$element=i(t),this.options=i.extend({},o,e),this.$container=null,this.$dialog=null,this.$choices=null,this.$data=null,this.screenWidth=0,this.scrollTop=0,this.placeholder="",this.useCssAnimation=!1,this.isDialogOpen=!1,this.isAnimate=!1,this._defaults=o,this._name=n,this.init()}var n="multipleSelector",o={containerSelector:".container",choicesSelector:".multipleselector-choices",choicesItemSelector:".multipleselector-item",dataSelector:".multipleselector-data",dialogClosebtnSelector:".multipleselector-close",containerSpace:0,cssAnimation:!1},a=i(t);s.prototype={setScreenWidth:function(){var i=this.screenWidth=a.innerWidth();this.$container.css("width",i-this.options.containerSpace),this.$dialog.css("width",i-this.options.containerSpace),this.isDialogOpen&&this.$container.css("marginLeft",-1*i)},containerTransitionEnd:function(){this.isDialogOpen?this.isDialogOpen=!1:this.isAnimate&&(a.scrollTop(1),this.$dialog.addClass("is-visible").focus(),this.isDialogOpen=!0,this.isAnimate=!1)},dialogTranstionEnd:function(){this.isAnimate&&this.isDialogOpen&&(a.scrollTop(this.scrollTop+1),this.$container.css("marginLeft",this.options.containerSpace/2),this.isAnimate=!1)},openDialog:function(i){var t=this;i.preventDefault(),this.scrollTop=a.scrollTop(),this.useCssAnimation?(this.isAnimate=!0,this.$container.css("marginLeft",-1*this.screenWidth)):this.$container.animate({marginLeft:-1*t.screenWidth},function(){t.$dialog.fadeIn().focus(),t.isDialogOpen=!0})},closeDialog:function(i){var t=this;i.preventDefault(),this.useCssAnimation?(this.isAnimate=!0,this.$dialog.removeClass("is-visible")):this.$dialog.fadeOut(function(){a.scrollTop(t.scrollTop),t.$container.animate({marginLeft:t.options.containerSpace/2}),t.isDialogOpen=!1}),this.$element.trigger(n+".selected")},refrectSelect:function(){var t=this,e=this.$dialog.find("input:checked"),s=e.eq(0).attr("name"),n=[],o=[];e.length>0?i.each(e,function(e,a){var l=i(a),c=l.siblings("label").text(),h=l.val();n.push(i("<span class='"+t.options.choicesItemSelector+"'>"+c+"</span>")),o.push(i("<input type='hidden' name='"+s+"' value='"+h+"'>"))}):n.push(this.placeholder),this.$choices.empty().append(n),this.$data.empty().append(o)},init:function(){var t=i(e),s=e.body.style;this.$container=t.find(this.options.containerSelector),this.$dialog=t.find("#"+this.$element.data("dialog-id")),this.$dialog.attr("tabIndex",-1),this.$choices=this.$element.find(this.options.choicesSelector),this.$data=this.$element.find(this.options.dataSelector),this.placeholder=this.$choices.text(),a.on("load resize",i.proxy(this.setScreenWidth,this)),this.$element.on("click",i.proxy(this.openDialog,this)),this.$element.on(n+".selected",i.proxy(this.refrectSelect,this)),this.$dialog.on("click",".multipleselect__btn-close",i.proxy(this.closeDialog,this)),this.refrectSelect(),this.options.cssAnimation&&("WebkitTransition"in s||"transition"in s)&&(this.useCssAnimation=!0,i("html").addClass("csstransitions"),this.$container.on("webkitTransitionEnd transitionend",i.proxy(this.containerTransitionEnd,this)),this.$dialog.on("webkitTransitionEnd transitionend",i.proxy(this.dialogTranstionEnd,this)))}},i.fn[n]=function(t){return this.each(function(){i.data(this,"plugin_"+n)||i.data(this,"plugin_"+n,new s(this,t))})}})(jQuery,window,document);