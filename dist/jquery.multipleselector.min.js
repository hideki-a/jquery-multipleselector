/*!
 * jQuery Multiple Selector Plugin
 *
 * Copyright 2013 Hideki Abe <hideki.abe@skyward-design.net>
 * Released under the MIT license
 *
 * Version: 0.1.1
 * Date: 2013-09-20
 */
(function(i,t,e){"use strict";function n(t,e){this.element=t,this.$element=i(t),this.options=i.extend({},o,e),this.$container=null,this.$dialog=null,this.$choices=null,this.$data=null,this.screenWidth=0,this.scrollTop=0,this.placeholder="",this.useCssAnimation=!1,this.isDialogOpen=!1,this._defaults=o,this._name=s,this.init()}var s="multipleSelector",o={containerSelector:".container",choicesSelector:".multipleselector-choices",choicesItemSelector:".multipleselector-item",dataSelector:".multipleselector-data",dialogClosebtnSelector:".multipleselector-close",containerSpace:0,cssAnimation:!1},a=i(t);n.prototype={setScreenWidth:function(){var i=this.screenWidth=a.innerWidth();this.$container.css("width",i-this.options.containerSpace),this.$dialog.css("width",i-this.options.containerSpace),this.isDialogOpen&&this.$container.css("marginLeft",-1*i)},containerTransitionEnd:function(){this.$container.off("webkitTransitionEnd transitionend"),a.scrollTop(1),this.$dialog.addClass("is-visible").focus(),this.isDialogOpen=!0},dialogTranstionEnd:function(){this.$dialog.off("webkitTransitionEnd transitionend"),a.scrollTop(this.scrollTop+1),this.$container.css("marginLeft",this.options.containerSpace/2),this.isDialogOpen=!1},openDialog:function(t){var e=this;t.preventDefault(),this.scrollTop=a.scrollTop(),this.useCssAnimation?(this.$container.on("webkitTransitionEnd transitionend",i.proxy(this.containerTransitionEnd,this)),this.$container.css("marginLeft",-1*this.screenWidth)):this.$container.animate({marginLeft:-1*e.screenWidth},function(){e.$dialog.fadeIn().focus(),e.isDialogOpen=!0})},closeDialog:function(t){var e=this;t.preventDefault(),this.useCssAnimation?(this.$dialog.on("webkitTransitionEnd transitionend",i.proxy(this.dialogTranstionEnd,this)),this.$dialog.removeClass("is-visible")):this.$dialog.fadeOut(function(){a.scrollTop(e.scrollTop),e.$container.animate({marginLeft:e.options.containerSpace/2}),e.isDialogOpen=!1}),this.$element.trigger(s+".selected")},refrectSelect:function(){var t=this,e=this.$dialog.find("input:checked"),n=e.eq(0).attr("name"),s=[],o=[];e.length>0?i.each(e,function(e,a){var l=i(a),c=l.siblings("label").text(),h=l.val();s.push(i("<span class='"+t.options.choicesItemSelector+"'>"+c+"</span>")),o.push(i("<input type='hidden' name='"+n+"' value='"+h+"'>"))}):s.push(this.placeholder),this.$choices.empty().append(s),this.$data.empty().append(o)},init:function(){var t=i(e),n=e.body.style;this.$container=t.find(this.options.containerSelector),this.$dialog=t.find("#"+this.$element.data("dialog-id")),this.$dialog.attr("tabIndex",-1),this.$choices=this.$element.find(this.options.choicesSelector),this.$data=this.$element.find(this.options.dataSelector),this.placeholder=this.$choices.text(),a.on("load resize",i.proxy(this.setScreenWidth,this)),this.$element.on("click",i.proxy(this.openDialog,this)),this.$element.on(s+".selected",i.proxy(this.refrectSelect,this)),this.$dialog.on("click",".multipleselect__btn-close",i.proxy(this.closeDialog,this)),this.refrectSelect(),this.options.cssAnimation&&("WebkitTransition"in n||"transition"in n)&&(this.useCssAnimation=!0,i("html").addClass("csstransitions"))}},i.fn[s]=function(t){return this.each(function(){i.data(this,"plugin_"+s)||i.data(this,"plugin_"+s,new n(this,t))})}})(jQuery,window,document);